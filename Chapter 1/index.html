
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../Chapter%202/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.12">
    
    
      
        <title>Getting started with cdk8s - Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#before-you-begin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)" class="md-header__button md-logo" aria-label="Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting started with cdk8s
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)" class="md-nav__button md-logo" aria-label="Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Write your Kubernetes Infrastructure as Go code (by Abhishek Gupta)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome!
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Chapter 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Chapter 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting started with cdk8s
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting started with cdk8s
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    Before you begin...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alright-lets-get-started" class="md-nav__link">
    Alright, lets get started!
  </a>
  
    <nav class="md-nav" aria-label="Alright, lets get started!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#youre-all-set-to-write-some-write-some-go-code" class="md-nav__link">
    You're all set to write some write some Go code!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#but-we-are-here-to-minimise-yaml" class="md-nav__link">
    But we are here to minimise yaml...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slight-detour-code-walk-through-and-concepts" class="md-nav__link">
    Slight detour (code walk-through and concepts)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alright-lets-get-back-on-track" class="md-nav__link">
    Alright, lets get back on track...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thats-not-all" class="md-nav__link">
    That's not all!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-wrapping-up" class="md-nav__link">
    Before wrapping up...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Chapter 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapter 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%202/" class="md-nav__link">
        cdk8s-plus in action!
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Chapter 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Chapter 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%203/" class="md-nav__link">
        Using Custom Resource Definitions with cdk8s
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Chapter 4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Chapter 4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%204/" class="md-nav__link">
        Extend cdk8s with custom Constructs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Chapter 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Chapter 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%205/" class="md-nav__link">
        Write your Kubernetes Infrastructure as Go code - Manage AWS services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Chapter 6
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Chapter 6
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%206/" class="md-nav__link">
        Write your Kubernetes Infrastructure as Go code - Combine cdk8s with AWS CDK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    Before you begin...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alright-lets-get-started" class="md-nav__link">
    Alright, lets get started!
  </a>
  
    <nav class="md-nav" aria-label="Alright, lets get started!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#youre-all-set-to-write-some-write-some-go-code" class="md-nav__link">
    You're all set to write some write some Go code!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#but-we-are-here-to-minimise-yaml" class="md-nav__link">
    But we are here to minimise yaml...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slight-detour-code-walk-through-and-concepts" class="md-nav__link">
    Slight detour (code walk-through and concepts)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alright-lets-get-back-on-track" class="md-nav__link">
    Alright, lets get back on track...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thats-not-all" class="md-nav__link">
    That's not all!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-wrapping-up" class="md-nav__link">
    Before wrapping up...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Getting started with cdk8s</h1>

<p><img alt="" src="../images/cdk8s.horizontal.color.png" /></p>
<p>This chapter will start things off and provide a gentle yet hands-on intro to <code>cdk8s</code>. By the end of it, you will be familiar with the key concepts and understand how to use <code>cdk8s</code> Go APIs to define a Kubernetes application, deploy (using <code>kubectl</code>) and test it out.</p>
<h3 id="before-you-begin">Before you begin...</h3>
<p>Make sure you have <code>Go</code> (<a href="https://go.dev/dl/">v1.16</a> or above) and <a href="https://github.com/cdk8s-team/cdk8s-cli">cdk8s CLI</a> installed. Also, you need to have access to a Kubernetes cluster. For learning and experimentation I would recommend using a single-node cluster running locally - such as <a href="https://minikube.sigs.k8s.io/docs/start/">minikube</a>, <a href="https://kind.sigs.k8s.io/docs/user/quick-start/#installation">kind</a>, etc.</p>
<blockquote>
<p>I generally use <code>minikube</code>, so setting up a cluster is as simple as <code>minikube start</code></p>
</blockquote>
<p><strong>To install cdk8s CLI</strong></p>
<p>You can choose from the below options:</p>
<pre><code class="language-bash">#homebrew
brew install cdk8s

#npm
npm install -g cdk8s-cli

#yarn
yarn global add cdk8s-cli
</code></pre>
<hr />
<h2 id="alright-lets-get-started">Alright, lets get started!</h2>
<blockquote>
<p>Although this chapter  will provide step-by-step instructions, you can always refer to the complete <a href="https://github.com/abhirockzz/cdk8s-for-go-developers/tree/master/part1-getting-started">code on Github</a></p>
</blockquote>
<p><code>cdk8s</code> makes it really easy for you get started and bootstrap your application. You don't need to guess and figure out how to structure your project, setup dependencies etc. since the <code>cdk8s init</code> command does it for you!</p>
<pre><code class="language-bash">cdk8s init go-app

#output
....

 Your cdk8s Go project is ready!

   cat help      Prints this message  
   cdk8s synth   Synthesize k8s manifests to dist/
   cdk8s import  Imports k8s API objects to &quot;imports/k8s&quot;

  Deploy:
   kubectl apply -f dist/
</code></pre>
<p>Once completed, you will get a directory structure as such:</p>
<pre><code class="language-bash">.
├── cdk8s.yaml
├── dist
│   └── test.k8s.yaml
├── go.mod
├── go.sum
├── help
├── imports
│   └── k8s
│       ├── internal
│       │   └── types.go
│       ├── jsii
│       │   ├── jsii.go
│       │   └── k8s-0.0.0.tgz
│       ├── k8s.go
│       ├── k8s.init.go
│       └── version
└── main.go
</code></pre>
<p>Update the generate <code>go.mod</code> file, and replace it with the following - this is to make things simpler for you. </p>
<blockquote>
<p>Feel free to use the latest version of the modules if needed.</p>
</blockquote>
<pre><code class="language-go">module getting-started-with-cdk8s-go

go 1.16

require (
    github.com/aws/constructs-go/constructs/v10 v10.1.42
    github.com/aws/jsii-runtime-go v1.60.1
    github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2 v2.3.29
)
</code></pre>
<h3 id="youre-all-set-to-write-some-write-some-go-code">You're all set to write some write some Go code!</h3>
<p>The canonical Kubernetes "hello world" is to get a <code>nginx</code> server up and running. The  easiest option is to use simply use <code>kubectl run</code> e.g. <code>kubectl run nginx --image=nginx</code>. But, since this is imperative, we switch to a declarative way where we define our desired state (in a <code>yaml</code> file) and ask Kubernetes to figure things out. </p>
<p>For e.g. we can write a <code>Deployment</code> manifest and submit it to Kubernetes using <code>kubectl apply -f &lt;name of the yaml file</code>&gt;.</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hello-nginx
  template:
    metadata:
      labels:
        app: hello-nginx
    spec:
      containers:
        - image: nginx
          name: nginx-container
          ports:
            - containerPort: 8080
</code></pre>
<h3 id="but-we-are-here-to-minimise-yaml">But we are here to minimise yaml...</h3>
<p>So, open the <code>main.go</code> file and copy the below Go code. Don't worry, I will walk you through it!</p>
<pre><code class="language-go">package main

import (
    &quot;getting-started-with-cdk8s-go/imports/k8s&quot;
    &quot;github.com/aws/constructs-go/constructs/v10&quot;
    &quot;github.com/aws/jsii-runtime-go&quot;
    &quot;github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2&quot;
)

type NginxChartProps struct {
    cdk8s.ChartProps
}

func NewNginxChart(scope constructs.Construct, id string, props *NginxChartProps) cdk8s.Chart {
    var cprops cdk8s.ChartProps
    if props != nil {
        cprops = props.ChartProps
    }
    chart := cdk8s.NewChart(scope, jsii.String(id), &amp;cprops)

    selector := &amp;k8s.LabelSelector{MatchLabels: &amp;map[string]*string{&quot;app&quot;: jsii.String(&quot;hello-nginx&quot;)}}

    labels := &amp;k8s.ObjectMeta{Labels: &amp;map[string]*string{&quot;app&quot;: jsii.String(&quot;hello-nginx&quot;)}}

    nginxContainer := &amp;k8s.Container{Name: jsii.String(&quot;nginx-container&quot;), Image: jsii.String(&quot;nginx&quot;), Ports: &amp;[]*k8s.ContainerPort{{ContainerPort: jsii.Number(80)}}}

    k8s.NewKubeDeployment(chart, jsii.String(&quot;deployment&quot;),
        &amp;k8s.KubeDeploymentProps{
            Spec: &amp;k8s.DeploymentSpec{
                Replicas: jsii.Number(1),
                Selector: selector,
                Template: &amp;k8s.PodTemplateSpec{
                    Metadata: labels,
                    Spec: &amp;k8s.PodSpec{
                        Containers: &amp;[]*k8s.Container{nginxContainer}}}}})

    return chart
}

func main() {
    app := cdk8s.NewApp(nil)
    NewNginxChart(app, &quot;nginx&quot;, nil)
    app.Synth()
}
</code></pre>
<p>When writing <code>cdk8s</code> based code in any language, you will come across a set of common concepts/terminologies - these include <code>Construct</code>, <code>App</code> and <code>Chart</code>. I will explain these as we walk through the code. </p>
<h2 id="slight-detour-code-walk-through-and-concepts">Slight detour (code walk-through and concepts)</h2>
<p>Start with the <code>main</code> function first - we use <a href="https://pkg.go.dev/github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2#NewApp">cdk8s.NewApp</a> to create an <a href="https://pkg.go.dev/github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2#App">App</a>.</p>
<p><strong>Well, what exactly in an <code>App</code>?</strong> It's is a <a href="https://github.com/aws/constructs">construct</a>, and you can think of <code>construct</code>s as higher-level building blocks to represent <strong>state</strong>. The key thing to note is that these constructs are <strong>composable</strong>. What that means is that you can define levels of these constructs (each level provides/exposes a different abstraction layer) and combine them to create your desired end state - in this case it happens to be a Kubernetes manifest with objects such as <code>Deployment</code>, but it could be something else. </p>
<blockquote>
<p>For e.g. an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">AWS CloudFormation template</a> (if you were to use <a href="https://docs.aws.amazon.com/cdk/v2/guide/home.html">AWS CDK</a>, not be confused with <code>cdk8s</code>)</p>
</blockquote>
<p>Back to the <code>App</code> - so, an <code>App</code> is also a construct. In fact you can think of it as the <strong>root</strong> in a tree (hierarchy) of constructs. So what else is there in that tree? Look the second line in the main function - <code>NewNginxChart(app, "getting-started", nil)</code> - this invokes a function  <code>NewNginxChart</code> that returns a <a href="https://pkg.go.dev/github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2#Chart">cdk8s.Chart</a> which is the next component in the hierarchy. AA cdk8s <code>App</code> can contain <strong>multiple</strong> charts and each chart can be converted (or in precise cdk8s terminology - <strong>synthesized</strong>) into a separate Kubernetes manifest file (you will see this action very soon). </p>
<p>Finally, draw your attention to the <code>NewNginxChart</code> function. It has a bunch of things, but notice the call to <code>k8s.NewKubeDeployment</code> function. This is where we actually define a Kubernetes <code>Deployment</code> in code (in the next section, we will also add a <code>Service</code> to the chart.) </p>
<blockquote>
<p>You can define multiple Kubernetes components in a chart, such a <code>Pod</code>, <code>Service</code>, <code>Ingress</code>, <code>Job</code> etc. - what ever you need for your application to work on Kubernetes.</p>
</blockquote>
<p>To summarise, here is a visual representation of what I just explained - remember everything is a <code>Construct</code> (<code>App</code>, <code>Chart</code> etc.)</p>
<p><img alt="Construct hierarchy" src="images/tree.png" /></p>
<p><strong>Wait, what about the Kubernetes API dependencies??</strong></p>
<p>If you've spent time working on accessing Kubernetes programmatically, this is an obvious (and great!) question. if you were to deal with k8s object using go, at the minimum you will need Kubernetes <a href="https://github.com/kubernetes/client-go/">client-go</a>, <a href="https://github.com/kubernetes/apimachinery">API machinery</a> etc. Guess what, <code>cdk8s</code> has got you covered there too!</p>
<p>You actually don't need to pull in these dependencies because <code>cdk8s</code> allows you to treat these Kubernetes API Objects as <code>constructs</code> - remember, everything is s construct! They are <em>automatically imported</em> to your project when you run the <code>cdk8s init</code> command, but you can do it explicitly using <a href="https://cdk8s.io/docs/latest/cli/import/">cdk8s import</a> as well. The resulting API is available as part of the <code>imports</code> folder (yes, go ahead and check that again!). On the top of <code>main.go</code>, check the package that is imported - its just refers to the <code>imports</code> folder.</p>
<blockquote>
<p>There is more to <code>cdk8s import</code> though. More to come in the chapters to follow!</p>
</blockquote>
<h2 id="alright-lets-get-back-on-track">Alright, lets get back on track...</h2>
<p>.. and continue with the practical bits. It's time to generate some yaml - you can't eliminate it, but at least you don't have to write it by hand! To do so, simply run:</p>
<pre><code class="language-bash">cdk8s synth
</code></pre>
<p>Once that completes (should be quick!), check the <code>dist</code> directory to check what <code>cdk8s</code> has generated.
To make it easier to understand, here is a diagram which has a one-to-one mapping (<em>notice the labels 1, 2,3, etc.?</em>) between the the <code>cdk8s</code> code objects/properties to their respective counterparts in yaml e.g. <code>spec.replicas</code>, <code>spec.selector</code>, <code>template.spec</code> etc.</p>
<p><img alt="cdk8s code to YAML mapping" src="images/go-yaml.png" /></p>
<p>You can now use good old <code>kubectl</code> to deploy this to Kubernetes since <code>cdk8s</code> is not going to do that for you, at least not yet ;)</p>
<pre><code>kubectl apply -f dist/
kubectl get pods -w
</code></pre>
<p>Once the <code>Deployment</code> is ready, the <code>Pod</code> should be in <code>Running</code> state. Simply use <code>port-forward</code> to access the <code>nginx</code> container port locally:</p>
<pre><code>kubectl port-forward &lt;enter nginx pod name&gt; 8080:80
</code></pre>
<p>To access <code>nginx</code> home page, navigate to <code>http://localhost:8080</code> using your browser</p>
<blockquote>
<p>You also use a CLI tool e.g. <code>curl localhost:8080</code>.</p>
</blockquote>
<h2 id="thats-not-all">That's not all!</h2>
<p>Instead of port forwarding, let's use the standard Kubernetes way of accessing applications by defining a <code>Service</code> resource, which is typically defined like this:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  ports:
    - port: 9090
      targetPort: 8080
  selector:
    app: hello-nginx
  type: LoadBalancer
</code></pre>
<p>But you know the rule - no yaml writing by hand! So, in the <code>NewNginxChart</code> function in the <code>main.go</code> file, add this piece of code after the part you defined the <code>Deployment</code>:</p>
<pre><code class="language-go">    k8s.NewKubeService(chart, jsii.String(&quot;service&quot;), &amp;k8s.KubeServiceProps{
        Spec: &amp;k8s.ServiceSpec{
            Type:     jsii.String(&quot;LoadBalancer&quot;),
            Ports:    &amp;[]*k8s.ServicePort{{Port: jsii.Number(9090), TargetPort: k8s.IntOrString_FromNumber(jsii.Number(80))}},
            Selector: &amp;map[string]*string{&quot;app&quot;: jsii.String(&quot;hello-nginx&quot;)}}})
</code></pre>
<p>First, delete the existing <code>Deployment</code> - <code>kubectl delete -f dist/</code>. Then, run <code>cdk8s synth</code> again to create the new manifest in the <code>dist</code> folder.</p>
<blockquote>
<p>Both the <code>Service</code> and <code>Deployment</code> are in the same file - this is because they are part of the <em>same</em> Chart.</p>
</blockquote>
<p>How you access the service will depend on the Kubernetes cluster. If you are using a cloud provider, it will likely provision a Load Balancer service native to that cloud e.g. <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html">Application Load Balancer in AWS</a>. Please adjust this as per your setup.</p>
<blockquote>
<p>For <code>minikube</code>, you can simply follow these instructions https://minikube.sigs.k8s.io/docs/handbook/accessing/#loadbalancer-access - <em>"Services of type LoadBalancer can be exposed via the <code>minikube tunnel</code> command."</em></p>
</blockquote>
<p>In a terminal, run this command (it runs as a separate process):</p>
<pre><code class="language-bash">minikube tunnel
</code></pre>
<p>In another terminal, <em>delete</em> the existing <code>Deployment</code> and then apply the new manifest:</p>
<pre><code class="language-bash">kubectl apply -f dist/
kubectl get pods -w
</code></pre>
<p>Check the <code>Service</code>:</p>
<pre><code class="language-bash">kubectl get svc
</code></pre>
<p>To access the <code>nginx</code> server, navigate to the external IP (as per the <code>Service</code>). In the case of minikube, you can simply use <code>localhost:9090</code> or <code>127.0.0.0:9090</code></p>
<blockquote>
<p>Remember to use port <code>9090</code> since that's the external port we specified in the Service configuration in our code</p>
</blockquote>
<h2 id="before-wrapping-up">Before wrapping up...</h2>
<p>.. I want to call out a couple of other useful things in <code>cdk8s</code>.</p>
<p><strong>Reference and reuse existing manifests and Helm charts</strong></p>
<p>Say you have a <code>Service</code> already defined in a <code>service.yaml</code> file. You can <a href="https://pkg.go.dev/github.com/cdk8s-team/cdk8s-core-go/cdk8s/v2#NewInclude">include</a> it in your <code>cdk8s</code> as part of a larger application/chart that you may have. Here is an example:</p>
<pre><code>cdk8s.NewInclude(chart, jsii.String(&quot;existing service&quot;), &amp;cdk8s.IncludeProps{Url: jsii.String(&quot;service.yaml&quot;)})
</code></pre>
<p>Similarly, you can also include <code>Helm</code> charts. Say you wanted to add <code>bitnami/nginx</code>:</p>
<pre><code class="language-go">cdk8s.NewHelm(chart, jsii.String(&quot;bitnami nginx helm chart&quot;), &amp;cdk8s.HelmProps{
        Chart:  jsii.String(&quot;bitnami/nginx&quot;),
        Values: &amp;map[string]interface{}{&quot;service.type&quot;: &quot;ClusterIP&quot;}})
</code></pre>
<blockquote>
<p>Well, you do need to have <code>helm</code> installed locally and also add the repo first <code>helm repo add bitnami https://charts.bitnami.com/bitnami</code> </p>
</blockquote>
<p><strong>Another handy feature is...</strong></p>
<p>... the ability to declare dependencies between any two <code>cdk8s</code> constructs. For instance, in the previous example, we had a <code>Deployment</code> and a <code>Service</code>. You could create a dependency as such:</p>
<pre><code>deployment := k8s.NewKubeDeployment(...)
service := k8s.NewKubeService(...)

deployment.AddDependency(service)
</code></pre>
<p>Thanks to <code>AddDependency</code>, the resulting manifest will be such that the <code>Service</code> is placed before the <code>Deployment</code> object. </p>
<blockquote>
<p>Dependency is <em>not</em> limited to individual constructs in a chart. If you have multiple charts as part of your <code>cdk8s</code> app, you can establish dependencies <em>across</em> charts as well.</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>Awesome. So you were able to "code" your way through trouble and ignore YAML. Hope you enjoyed it! To keep things simple, I demonstrated a <code>Deployment</code> and <code>Service</code>, but you can choose from other Kubernetes components such as <code>Ingress</code>, <code>Job</code> etc. They are all exposed using a similar pattern i.e. NewKube<Resource> for e.g. <code>NewKubeJob</code>, <code>NewKubeIngress</code> etc. </p>
<p>But there is still a lot of boilerplate code involved in defining Kubernetes components. Writing Go code sounds way better than YAML engineering (at least to me), it seems as if we are translating existing YAML into Go structs (and fields). In the next chapter, we will explore how to improve this further.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c2be25ad.min.js"></script>
      
    
  </body>
</html>